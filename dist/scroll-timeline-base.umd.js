(function(f,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(f=typeof globalThis<"u"?globalThis:f||self,n(f.ScrollTimelineBase={}))})(this,function(f){"use strict";const n=new WeakMap,c=new WeakMap;function a(s){return s===document.scrollingElement?document:s}function v(s,e){const t=c.get(s).sourceMeasurements;let i=t.scrollTop;return e==="x"&&(i=Math.abs(t.scrollLeft)),i}function T(s,e){const t=c.get(s).sourceMeasurements;return e==="y"?t.scrollHeight-t.clientHeight:t.scrollWidth-t.clientWidth}function m(s){return{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop,scrollWidth:s.scrollWidth,scrollHeight:s.scrollHeight,clientWidth:s.clientWidth,clientHeight:s.clientHeight}}function h(s){const e=c.get(s);e.sourceMeasurements=m(s);for(const t of e.timelineRefs)t.deref();e.updateScheduled||(setTimeout(()=>{for(const t of e.timelineRefs)t.deref();e.updateScheduled=!1}),e.updateScheduled=!0)}function g(s,e){const t=n.get(s),i=t.source;if(i!==e){if(i){const o=c.get(i);if(o){o.timelineRefs.delete(s);const l=Array.from(o.timelineRefs).filter(u=>typeof u.deref()>"u");for(const u of l)o.timelineRefs.delete(u);o.timelineRefs.size===0&&(o?.disconnect?.(),c.delete(i))}}if(t.source=e,e){let o=c.get(e);if(!o){o={timelineRefs:new Set,sourceMeasurements:m(e)},c.set(e,o);const l=new ResizeObserver(r=>{for(let d=0,x=r.length;d<x;d++)h(t.source)});l.observe(e);for(const r of e.children)l.observe(r);const u=new MutationObserver(r=>{for(const d of r)d.target instanceof HTMLElement&&h(d.target)});u.observe(e,{attributes:!0,attributeFilter:["style","class"]});const p=()=>{o.sourceMeasurements.scrollLeft=e.scrollLeft,o.sourceMeasurements.scrollTop=e.scrollTop;for(const r of o.timelineRefs)r.deref()};a(e).addEventListener("scroll",p),o.disconnect=()=>{l.disconnect(),u.disconnect(),a(e).removeEventListener("scroll",p)}}o.timelineRefs.add(new WeakRef(s))}}}class y{constructor({source:e=document.documentElement,axis:t="y"}){n.set(this,{source:null,axis:t}),g(this,e)}cancel(){c.get(this.source).disconnect?.()}get source(){return n.get(this).source}set source(e){g(this,e)}get axis(){return n.get(this).axis}set axis(e){n.get(this).axis=e}get phase(){const e=this.source;if(!e)return"inactive";const t=getComputedStyle(e);return t.display==="none"||e!==document.scrollingElement&&(t.overflow==="visible"||t.overflow==="clip")?"inactive":"active"}get currentTime(){const e=this.source;if(!e||!e.isConnected||this.phase==="inactive")return null;const t=getComputedStyle(e);if(t.display==="inline"||t.display==="none")return null;const i=this.axis,o=v(e,i),l=T(e,i);return l>0?{value:100*o/l}:{value:100}}}f.ScrollTimeline=y});
